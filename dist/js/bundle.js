(()=>{var e={9(){const e=[{id:"wgs84",name:"WGS 84",code:"EPSG:4326",description:"Всемирная геодезическая система 1984 года",type:"географическая",ellipsoid:"WGS 84",area:"Весь мир",datum:"WGS84"},{id:"sk42",name:"СК-42",code:"EPSG:4284",description:"Система координат 1942 года",type:"географическая",ellipsoid:"Красовского",area:"СССР/Россия",datum:"Пулково 1942"},{id:"pulkovo42",name:"Пулково 1942",code:"EPSG:4284",description:"Пулковская система координат 1942 года",type:"географическая",ellipsoid:"Красовского",area:"СССР/Россия",datum:"Пулково 1942"},{id:"msk",name:"МСК",code:"Местная СК",description:"Местная система координат",type:"плоская прямоугольная",ellipsoid:"Красовского",area:"Локальная зона",datum:"Местный"},{id:"msk52",name:"МСК-52",code:"СК-52",description:"Московская система координат 1952 года",type:"плоская прямоугольная",ellipsoid:"Красовского",area:"Московская область",datum:"Пулково 1942"},{id:"msk63",name:"МСК-63",code:"СК-63",description:"Московская система координат 1963 года",type:"плоская прямоугольная",ellipsoid:"Красовского",area:"Московская область",datum:"Пулково 1942"},{id:"utmn",name:"UTM Северное",code:"EPSG:326XX",description:"Универсальная поперечная проекция Меркатора",type:"проекционная",ellipsoid:"WGS 84",area:"Зональная",datum:"WGS84"},{id:"utms",name:"UTM Южное",code:"EPSG:327XX",description:"Универсальная поперечная проекция Меркатора",type:"проекционная",ellipsoid:"WGS 84",area:"Зональная",datum:"WGS84"},{id:"gauss",name:"Гаусс-Крюгер",code:"СК-42 ГК",description:"Проекция Гаусса-Крюгера",type:"проекционная",ellipsoid:"Красовского",area:"СССР/Россия",datum:"Пулково 1942"},{id:"cgcs2000",name:"CGCS 2000",code:"EPSG:4490",description:"Китайская геодезическая система координат 2000",type:"географическая",ellipsoid:"CGCS2000",area:"Китай",datum:"CGCS2000"},{id:"nad83",name:"NAD83",code:"EPSG:4269",description:"Североамериканская система 1983 года",type:"географическая",ellipsoid:"GRS 80",area:"Северная Америка",datum:"NAD83"},{id:"ed50",name:"ED50",code:"EPSG:4230",description:"Европейская система 1950 года",type:"географическая",ellipsoid:"International 1924",area:"Европа",datum:"European 1950"}];class t{constructor(e,t,s,n){this.input=e,this.dropdown=t,this.infoElement=s,this.placeholder=n,this.selectedIndex=-1,this.filteredSystems=[],this.input.selectedSystem=null,this.init()}init(){this.infoElement&&(this.infoElement.style.display="none",this.infoElement.innerHTML=`<p class="info-placeholder">${this.placeholder}</p>`),this.input.addEventListener("input",e=>this.handleInput(e)),this.input.addEventListener("keydown",e=>this.handleKeyDown(e)),this.input.addEventListener("blur",()=>{setTimeout(()=>this.hideDropdown(),200)}),this.input.addEventListener("focus",()=>this.handleFocus()),this.input.addEventListener("click",()=>this.handleClick())}handleInput(t){const s=t.target.value.toLowerCase().trim();if(""===s)return this.input.selectedSystem=null,this.infoElement&&(this.infoElement.style.display="none",this.infoElement.innerHTML=`<p class="info-placeholder">${this.placeholder}</p>`),void this.showAllSystems();this.filteredSystems=e.filter(e=>e.name.toLowerCase().includes(s)||e.code.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)),this.updateDropdown()}handleKeyDown(t){if("block"!==this.dropdown.style.display)return;const s=this.dropdown.querySelectorAll(".autocomplete-item:not(.no-results)");if(0===s.length)return;const n=this.dropdown.querySelector(".autocomplete-item.active");let o=n?Array.from(s).indexOf(n):-1;switch(t.key){case"ArrowDown":t.preventDefault(),n&&n.classList.remove("active"),o=(o+1)%s.length,s[o].classList.add("active"),s[o].scrollIntoView({block:"nearest"});break;case"ArrowUp":t.preventDefault(),n&&n.classList.remove("active"),o=(o-1+s.length)%s.length,s[o].classList.add("active"),s[o].scrollIntoView({block:"nearest"});break;case"Enter":t.preventDefault();const i=this.dropdown.querySelector(".autocomplete-item.active");if(i){const t=i.dataset.systemId,s=e.find(e=>e.id===t);s&&this.selectSystem(s)}break;case"Escape":this.hideDropdown()}}handleFocus(){""===this.input.value.trim()?this.showAllSystems():this.handleInput({target:this.input})}handleClick(){""!==this.input.value.trim()&&"none"!==this.dropdown.style.display||this.showAllSystems()}showAllSystems(){this.filteredSystems=[...e],this.updateDropdown()}updateDropdown(){if(this.dropdown.innerHTML="",0===this.filteredSystems.length){const e=document.createElement("div");e.className="autocomplete-item no-results",e.textContent="Системы не найдены",this.dropdown.appendChild(e)}else this.filteredSystems.forEach((e,t)=>{const s=document.createElement("div");s.className="autocomplete-item",s.dataset.systemId=e.id,s.tabIndex=0,t===this.selectedIndex&&s.classList.add("active"),s.innerHTML=`\n                    <div class="system-name">${e.name}</div>\n                    <div class="system-code">${e.code}</div>\n                    <div class="system-description">${e.description}</div>\n                `,s.addEventListener("click",()=>{this.selectSystem(e)}),s.addEventListener("mouseenter",()=>{this.dropdown.querySelectorAll(".autocomplete-item").forEach(e=>{e.classList.remove("active")}),s.classList.add("active"),this.selectedIndex=t}),s.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.selectSystem(e))}),this.dropdown.appendChild(s)});this.dropdown.style.display="block"}selectSystem(e){this.input.value=e.name,this.input.selectedSystem=e,this.updateInfo(e),this.hideDropdown(),this.input.focus(),console.log("Выбрана система:",e.name)}updateInfo(e){this.infoElement&&(e?(this.infoElement.innerHTML=`\n                <div class="info-name">${e.name}</div>\n                <div class="info-tags">\n                    <span class="tag">${e.code}</span>\n                    <span class="tag">${e.type}</span>\n                </div>\n                <div class="info-meta">\n                    <span><strong>Эллипсоид:</strong> ${e.ellipsoid}</span>\n                    <span><strong>Регион:</strong> ${e.area}</span>\n                    <span><strong>Датум:</strong> ${e.datum}</span>\n                </div>\n                <p class="info-desc">${e.description}</p>\n            `,this.infoElement.style.display="block",this.infoElement.classList.add("visible")):(this.infoElement.style.display="none",this.infoElement.innerHTML=`<p class="info-placeholder">${this.placeholder}</p>`))}hideDropdown(){this.dropdown.style.display="none",this.selectedIndex=-1}}document.addEventListener("DOMContentLoaded",()=>{const e=new t(document.getElementById("sourceSystemInput"),document.getElementById("sourceDropdown"),document.getElementById("sourceSystemInfo"),"Выберите исходную систему"),s=new t(document.getElementById("targetSystemInput"),document.getElementById("targetDropdown"),document.getElementById("targetSystemInfo"),"Выберите целевую систему"),n=document.getElementById("swapCoordinatesButton");n.addEventListener("click",()=>{const t=document.getElementById("sourceSystemInput"),o=document.getElementById("targetSystemInput"),i=document.getElementById("sourceSystemInfo"),r=document.getElementById("targetSystemInfo"),a=t.value,d=o.value,l=t.selectedSystem,c=o.selectedSystem;t.value=d,o.value=a,t.selectedSystem=c,o.selectedSystem=l,c?e.updateInfo(c):(i.style.display="none",i.innerHTML='<p class="info-placeholder">Выберите исходную систему</p>'),l?s.updateInfo(l):(r.style.display="none",r.innerHTML='<p class="info-placeholder">Выберите целевую систему</p>'),n.classList.add("swap-animation"),setTimeout(()=>{n.classList.remove("swap-animation")},500),t.focus()}),document.addEventListener("click",t=>{t.target.closest(".input-with-dropdown")||(e.hideDropdown(),s.hideDropdown())})})},923(e){class t{constructor(){this.coordinateSystems={"WGS 84":"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","EPSG:4326":"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","Пулково 1942":"+proj=tmerc +lat_0=0 +lon_0=30 +k=1 +x_0=0 +y_0=0 +ellps=krass +towgs84=25,-141,-78.5,0,0.35,0.736,0 +units=m +no_defs","СК-42":"+proj=tmerc +lat_0=0 +lon_0=30 +k=1 +x_0=0 +y_0=0 +ellps=krass +towgs84=25,-141,-78.5,0,0.35,0.736,0 +units=m +no_defs","EPSG:4284":"+proj=longlat +ellps=krass +towgs84=25,-141,-78.5,0,0.35,0.736,0 +no_defs",МСК:"+proj=tmerc +lat_0=55.6666666666667 +lon_0=37.5 +k=1 +x_0=0 +y_0=0 +ellps=krass +towgs84=25,-141,-78.5,0,0.35,0.736,0 +units=m +no_defs","МСК-52":"+proj=tmerc +lat_0=55.6666666666667 +lon_0=37.5 +k=1 +x_0=0 +y_0=0 +ellps=krass +towgs84=25,-141,-78.5,0,0.35,0.736,0 +units=m +no_defs","UTM 36N":"+proj=utm +zone=36 +ellps=WGS84 +datum=WGS84 +units=m +no_defs","EPSG:32636":"+proj=utm +zone=36 +ellps=WGS84 +datum=WGS84 +units=m +no_defs","Web Mercator":"+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs","EPSG:3857":"+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs"},this.transformers={}}getSystemDefinition(e){if(this.coordinateSystems[e])return this.coordinateSystems[e];const t=e.toLowerCase();for(const[e,s]of Object.entries(this.coordinateSystems))if(e.toLowerCase().includes(t))return s;return null}getTransformer(e,t){const s=`${e}->${t}`;if(!this.transformers[s]){const n=this.getSystemDefinition(e),o=this.getSystemDefinition(t);if(!n||!o)throw new Error(`Неизвестная система координат: ${n?t:e}`);this.transformers[s]=proj4(n,o)}return this.transformers[s]}transformPoint(e,t,s,n){try{const o=this.getTransformer(s,n).forward([parseFloat(e),parseFloat(t)]);return{x:o[0],y:o[1],success:!0,error:null}}catch(e){return console.error("Ошибка преобразования координат:",e),{x:null,y:null,success:!1,error:e.message}}}transformDataFrame(e,t,s){if(!e||!t||!s)throw new Error("Необходимо указать датафрейм и системы координат");const n=e.columns;if(!n.includes("x")||!n.includes("y"))throw new Error('Датафрейм должен содержать столбцы "x" и "y"');const o=e.copy(),i=[],r=[],a=[],d=[];for(let n=0;n<e.shape[0];n++){const o=e.iloc(n),l=o.get("x"),c=o.get("y");if(null===l||null===c||void 0===l||void 0===c||""===l||""===c||isNaN(parseFloat(l))||isNaN(parseFloat(c))){i.push(null),r.push(null),a.push("Пустые или некорректные координаты"),d.push("error");continue}const p=this.transformPoint(l,c,t,s);p.success?(i.push(p.x),r.push(p.y),a.push(null),d.push("success")):(i.push(null),r.push(null),a.push(p.error),d.push("error"))}return o.x_transformed=i,o.y_transformed=r,o.transformation_error=a,o.transformation_status=d,o}transformBatch(e,t,s){return e.map((e,n)=>{const o=this.transformPoint(e.x,e.y,t,s);return{id:e.id||n+1,name:e.name||`Точка ${n+1}`,x_original:e.x,y_original:e.y,x_transformed:o.x,y_transformed:o.y,status:o.success?"success":"error",error:o.error,source_system:t,target_system:s}})}getTransformationStats(e){const t=e.length,s=e.filter(e=>"success"===e.status).length;return{total:t,success:s,errors:e.filter(e=>"error"===e.status).length,successRate:t>0?(s/t*100).toFixed(2):0}}addCoordinateSystem(e,t){this.coordinateSystems[e]=t,this.transformers={}}getAvailableSystems(){return Object.keys(this.coordinateSystems)}isSystemSupported(e){return null!==this.getSystemDefinition(e)}getSystemInfo(e){const t=this.getSystemDefinition(e);return t?{name:e,definition:t,type:this.getSystemType(t),units:this.getSystemUnits(t)}:null}getSystemType(e){return e.includes("+proj=longlat")?"Географические координаты (широта/долгота)":e.includes("+proj=tmerc")?"Поперечная проекция Меркатора":e.includes("+proj=utm")?"UTM проекция":e.includes("+proj=merc")?"Проекция Меркатора":"Проекция"}getSystemUnits(e){return e.includes("+units=m")?"Метры":e.includes("+proj=longlat")?"Градусы":e.includes("+units=ft")?"Футы":"Неизвестно"}}e.exports&&(e.exports=t),"undefined"!=typeof window&&(window.CoordinateConverter=t)}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s(9),s(923)})();